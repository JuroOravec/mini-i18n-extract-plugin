os: linux
dist: xenial

branches:
  only:
    - master
  except:
    - /temp\/.*/

language: node_js
node_js:
  - '10'
  - '11'
  - '12'
  - '13'

before_install:
  # Configure signed git commits from within Travis CI, see:
  # https://github.com/semantic-release/git/tree/905f113a577c55cd9bb0a37ea3504d9e8ee2dfa2#gpg-signature
  # Decrypt git_gpg_keys.asc.enc key into /tmp/git_gpg_keys.asc
  - openssl aes-256-cbc -K $encrypted_44fd1061a48b_key -iv $encrypted_44fd1061a48b_iv -in ./config/travis-ci/git_gpg_keys.asc.enc -out /tmp/git_gpg_keys.asc -d
  # Make sure only the current user can read the keys
  - chmod 600 /tmp/git_gpg_keys.asc
  # Import the gpg key
  - gpg --batch --yes --import /tmp/git_gpg_keys.asc
  # Create a script that pass the passphrase to the gpg CLI called by git
  - echo '/usr/bin/gpg --passphrase ${GPG_PASSPHRASE} --batch --no-tty "$@"' > /tmp/gpg-with-passphrase && chmod +x /tmp/gpg-with-passphrase
  # Configure git to use the script that passes the passphrase
  - git config gpg.program "/tmp/gpg-with-passphrase"
  # Configure git to sign the commits and tags
  - git config commit.gpgsign true
  # Configure git to use your GPG key
  - git config --global user.signingkey ${GPG_KEY_ID}
install:
  - npm install
  # Remove installation side effects (like updated package-lock.json)
  - git reset --hard HEAD
before_script:
  - npm run setup
script:
  - commitlint-travis
  - npm run validate

jobs:
  include:
    - stage: codecov
      node_js: lts/*
      script:
        - npm run test:cov

    - stage: update CHANGELOG.md
      if: type = pull_request
      node_js: lts/*
      script: npx semantic-release # runs with PR-specific config

    - stage: release
      node_js: lts/*
      script: ':' # noop, skips tests
      deploy:
        edge: true
        provider: script
        script: npx semantic-release
        on:
          # Branch selection is managed by semantic-release in .releaserc.yml
          all_branches: true
          repo: JuroOravec/mini-i18n-extract-plugin
      after_deploy:
        - npx snyk monitor

notifications:
  email:
    on_success: never

env:
  global:
    # GH_TOKEN - semantic-release/github
    - secure: QoBXEcfMAtALTEd/OVeyFKOfew4SBBR5FAGpU9cw3Xjk/hA4v+6k62FxfmIc1ScEFR7OsAfu65Syc7/xHOITXvEd8aePud81oud+qlUotgQhvBQWyODMpg8UEzyRqUd+plIOXRzxj9LYD3Jg46nh4ECK/mZee3WAXYo3me5PO58b89zJw9WDHapEEvOMGYHxBL6usp2Ly1xWOFasJFy1Ja5UiRhtsAmk4zyM3Qu2SKXcOHkkkqLv6EHRP5oE5tVrjbtUu5nhlQdYn2zmsr16PFRgmtHlf0cSIxSmmLQ8YnNVx47CUr2He+TUePThnR1stg7Lvf+E5aK6nSNyl4mtWocyagptIV+IEnS6IwbfO/Z1Kd/WntVq91laUqtY07+2PZiTKZgUa8NJSw/6mN6meAStz+KyDQ573YSHJddslq2e+6SHP7Fz91ltUap9qk2hpb7t9C9+KCemvnncb/YoQtdQz6jDxQA6Q9h+K0Nzy7I1bsnC9uWbedG0pYK0Wt7L7MaXQaXMMbvNblVOYemJgHUyGwCMw7L1y2FdZQHXkrd8ph+xyUhiTYdqUoIkYbW25ZunzTv35CEBEtfpLDuDCnutTQ25gHiL54aYNhGuljwMbud2f2lBN9X2XAPMd+u61t9R55uLcpybONZEHKJNs1/OWvytj06nyzIJiTfOABs=
    # NPM_TOKEN - semantic-release/npm
    - secure: Q0ZOdmfXrAJ7acaUai6mshNVStjRcGPZ2VMLuX25+oPZsQqkqMaUsbAWb7JIVvS7TXdnY2AvQeV3KKRXooIbzaNOZOM48sxa6paK+SFaazliPJ9Xjk8tnVzEpC/uX65WwLGdWj2nj30jCEyGDnclb+3CufL6QHAx2D2jHQLIEl2d1nNA9U/t7N/lyLPxw5vlZ+RKDV/5Nizi785SwHv1HypA18Za4BMDdZ3n2M6TqWfwVVIIXt4P1BbLiIEQ2Z3EYRgl5ZrKzHjQm6JltvlHM9tqjCHHtZarbRgpFVX1I872vkNv3MFOOxLz+SSqyT+b2Fn2PpSHL2SgGChtovQBk7tXSb3O0xQYZLflsQrCCpCPR5OaJ1HecWTAECKQ3CZ7LOoVx9lcKsCzTZL/IjaqWvIzdHSuK8MXRJEWaDvLfeHsYRfZdWEw9A4OGGo3Knb5yYHvqrtzZmz45JxTeYu1ceFCh66WyBHv+BvEwbkamss/1SLJv4w5+LbGOhkaonkIzQPOh8MDNsLo6hJeo0EqXpJyM5oz1z5bIlJ/qY5bzXn3yWEUUh//p2CBNn2acbZxHW8bp/+hsYDJFcpWPagGE0GN0/lTTxYAy5+cK/syxhte3fDdBkZOC+yasjpEesXTKgYZIktv+xzodGKkf+S0kpizgSK+arv1bTA9kKv7xYQ=
    # SNYK_TOKEN
    - secure: tK7oCZiZxfRUydIUwpdMxQ564emPyqRNm4tZXyxIbHCjzaiwFwWKLZVQxPxS49iMghU/0vm09R0R5lAjkknYkgeBuSFspOerjlickRKyfPpyR96WDiFEn6ZW7w5mp9E5IVxfQYAqNfdWJivXFOw9Kqz4RSi3l8ixBG3NgtP1E4Yyc6lD+qsiF7JWsu3DN1VtqCWsIqqL1DYkX3IN0v6Witz69RSoc1sUd+ZRjMaUChTpZC7K/zOTLQ93dItq2UvrlmPzTlyT3YCsBB98oENzk05xJVrYMT6TUImEa3YE0J9UezPfGAfLKE9lGWpYiRXjpqVfaI6IEMB5i305BVVS+QNzqNM3s+vEwZb2moYvbMxw0QYIfVYL16xLL5Tm4MwUweVhCJq+n9tdHJWpQoNYdlJJI4gfGRDrjfnjdmXCC+B1MVFv7lPbPUe0zrMYE4YNcF0ZOTVu/REO7naVM3bCoJhMDYGYcA5tRLS3nRreH6DWGanwGInOELC6Ta//iCh9VpLUhF0YLfm1vp+4e2uVIZmL9cFCy0fnXPrVCgMqlrBOn2EY25irkZrVfDQwMYixcG9qFyF5LOGXBh85M3CR3gO/rG5ycCYCrsu4kEMYdlk44MoX//hBaGkBcxbn9OqZoejgDtJv6092dGYwVQ+cNZgnhkYKIObV8OgPbwUgFAs=
    # GPG signature env vars
    # https://github.com/semantic-release/git/tree/905f113a577c55cd9bb0a37ea3504d9e8ee2dfa2#gpg-signature
    # GPG_PASSPHRASE
    - secure: ca8fnFoAVVLrvfG7V5v1Ha3MJTVQHHjIScHxwL50LlpbGmDd73BK1lUe1EvNVeAo9e1aLkMFIpSmDToJbBsub+kcSOv3q1BSe/IktNWaWTMEJcUsx1TM+Ejx/OFnESeREcOfBPlBmP7uijdRBqYBdVg7Kfp6d7b67gHsj2G5X7Y5mBQih+/vG/Xzn6BhrBZfuEGYoV4dXQUp+SDof4fiMCo+2uif6iI0H30lanjeID+Ud9XkbmO+a369tVuAzgSepGRuzw/5HgJLv+yeV4+FPOSXc/T0OC5MnlSrwe8OVrTgBer1Ah7jbpNKIgERX8jmcWA248AaAMsXTBTjeKhvsOXXEFQWmvzzZ+WrA/TNjxTCzz17FihBfVbs5pRuCJYlJ8UaICPTPqG2hOfJpyJaFBnWrNujCnD9L1aEQYh9WcE4QmSkB9yLakOQXHPf5fTV/UjnSvHtCiJFnwL5vPYV84+OxveU1EgMo753ruBtjjngMKrinwQmx7YEf4H7ooklXzrsEVoP1i8XRYbokgAGE7EDvCjotrNa1h4lZDQvB5EA0D8EBm86BI5d/inZahIoi1fLFuNZ0dTIyn2VRy2MWxNeLa+LCQWibFTh1vk4Rbuoa1DRGCRQhfr911q5Yh0Eo709xY39LgW9UJ7WLDlWpizIUAoAGyoM0he7j4Kriv0=
    # GPG_KEY_ID
    - secure: h4MbmQDcGrO5+ob1pmeeEVdcmaJvd0f+/kaU5g4KERdYoQZv220yJsCypT0Rsoq8gm3EEZMNfVxsGA/k5Qh2nNWxHF0NdBD4NduO94pxDFkmDBO1rrskxtXZ9F6q24trjw79vtuWDZiJALXWmo9hMrTSEOhuR1dwElDC9YAbOtCxTMeAVXtYpwsmoEjH2qhT+Jdd+4dxPa+rJdrblf3LGFNaufSvFjnvksL8LSInUHlTwO/qzqpLlSQb6vKoI2r/nuuLaKkyqumlTKDV8dm3PjFccT1+f/3v1LUR7sE+6zD+dAUF2TH9ANFX7pkU3wyEoTZO8IEMLo5IPRNHFZYTwuENU0qKDa+UmyG+5AttWLIa065G/MeJhXa0ppDR+B5DMn03VzMj1gWqryY7A4qKxGNxuUBjtfCPTWlPybx7a5W97I81IHYiQACShIEWOLRQYtNJ+UNb8LxnOc/c4s628BTVkOuFMxM1B8TAaSMZAqNqm0kc12CR6r23qLkfZ5M8Xky0EXj97kFICxoXSqXGXs1QoCIZTRgv8418UW3RCiJ4I7DKeVGKCosaXPxNaVFFptXr5qaU8dgmjxIMSRWP5dLp5wnimWybJ6Knw9jL2+XBARBaU17/Rlb2vDhVKwXkzo+vtkii+dT9SYU5ibVedD+xI2gFqnnuvJK/Eg6HBHQ=
    # GIT_EMAIL
    - secure: 'wInshVRkCbvvHwtFF9WCJuWXmTAZd/1HrtzCqj14CNwj02PHtHnLb7j4fcfRtqJHIbzwxqIo+P3x1RK/irX6xJAr6iowXeZnjV/5lr88UgbqUyfgL2IO2oHU5AZENR04hJ8KwIGelkSMOB0oL1kCPnYYwLqET0IrFi2nv5AWTnuAdj+r4DWzO4GQdSCIiRNJ7roNsENScgoqL8m0d049aAtm3ygHej8vZpe/oCkm2WtssT5i00VFM3wbX7hoxpvjbnGxNhpOizXDQqWjNX8elxbs25k29kk/4nKvIVB0Z9NiC65obw09iS0Tt9svaUWETs48rBBgZgmN+vthpi9LtmSqQYt9DZ9tqYGOhy5WAfvWahj1W1SJhy9t9pnhYpdvmw0T99O6tZjwSHsbBiRf9tT6YtPUHhgqMgLYTqf8lO/amCUPa+Qt648rEeBuAHpGmDQfzugEor30CipcxyLis1mob200uRVVrcWViBlhGKdXyXLMzZ/uJl4Ey8Z4Ff9E1XCJt3gYTYAMcWGBmSD4JeLrXiG/EMR62P7T14aV4FNDNQyYuraTVQsRQwv12g1V9Sk1NiKuQp23b3D/bUl52xy3+/GAeorebI7kYzVSo4JDTIEBgcAc5KsAQuUgY1CJYCnqs+RFsZluLrd6sHji/9F0BYtGQs1wLNIKE7W2yrI='
    # GIT_USERNAME
    - secure: 'VoSwv0tPsw0C51mh5QJuXhc0Egjk3RJVa1xT3aag52oL8C7SdIC8hbqbhG0J2QcDz5XJi0mTKj9Z9XjKjKXDYOMKsBqK/SBXLD/XeCpKBrR6OjzkliJGM1JvEirx6xaoiwA9IhEvEuwi4TuA3Pi1/QHRN8hHe3ponAn6QcpIYocmVv21iiPULzfNJCJTWLGSWr7QTKQqtscGvSUpJXIMbZf+pnEzybugP1x0TeDwbl6KvLCkX/yLf7TrEX2qoopU2xqyLQ2a5P2pWIGABflqea4znKkL9fq/ewiJlmYGFmqcNv5BJZIaZKqSL5tjGeQNN1AuXsJoOdIXtH60NORB/ZNDGTYME9/GgwalflSIHk9rAsAOr9O0Ib49k+zsqAqVsVmiE/spGem5KYRRqwYI5D/cEpniCvNQAZLgI9bYnjf3FF5iM4/bX9ZwPOcrLWW1ePbJzl641HuejyR245l0wGAwHvLui8k6ll5WeajrV+Ow5JwgmqrO2051xxP9J56aDAmRLPECKmr+ddaXQqBgh4bDuRHfPL+lRrNjj8ZiQBxzjF3eJrcuqw/m/ctjFITCVqreVsW5PVl28ltks0M3PaNa5xcuWIhBKv3EH2KFM74/ll3hvj8LunVvPzO89Bi+jcYoveCFSYJeaTRSCJ7fNy/hdNbgX6n1mGBtwEvkaAU='
    # GIT_COMMITTER_NAME (to have signed commits from semantic-release)
    - secure: 'CLVTg6w6RK3SoUPlRKwI2BUcTLzOG4ock5VU+m6vLa7KFyOXfmKeyCZnnnRgAhv9zDc/1pIidymGIZkuq/YXVLHVwT2K/IYxVdCcMHbnV0NXeci6RjsV0K3smb6zVUv27w8Q+mO1MKigY6Eq5k2ZgTGmoI1Je6PNpQBzih0mr62tdjxTNyL3ZJtzMJ1Z8uSOPETq2HautClYjcyIizWW4RbTcGDLq1WfGG7wDyv2qX00swv8uzztrgKXG3B1l/PNw3ApXBv+7kZjMwAdYfgpCnp8s6A7I74klXI5V2MR5PLGTBBL/rGku68N4asvGl9w+dputNIs/wLGY9qAGDP7WuD15UmZ0WMhv7sTC8Z6WUEhLXY5kwNLeYAd6V5nRgEW2BmY1Q1d+i0pSYDdr2gotKJI003qdJnUf+Ddsn/9PA3Mr5F5Qql75PVhkKvT5UCSPG34Io2/neKxX/FsxYAvtlwzQbWhoNqtr8NauT1izjD+QCMs1B5SR9wrSGxSo2Op6rzyHO/fViRt8KQeCwDjQmhe5mjL1st3pRbLV7DJEKpsA8YYy+j1yVL5GLA3XqSTVKwa1Ng/2Xzcfrw8q/GKSyqPYahvONn9zDpMr/V6j4W17N9JNdLAx6/GwGwTNc2wb+qHGY0cgsu2DVkGrYVuIf0+alkYg6Xh6wwlxBeubCQ='
    # GIT_COMMITTER_EMAIL (to have signed commits from semantic-release)
    - secure: 'RqyPQ91OT3xcFbsfjG2y6X9wOaXup13xKR9/dAEg0vlX4OVs7GL5fDU+FeqVcFiVdoaW9p+UEYUykokM0WbW/+ljYxvCUpCik5LXxWMJChARmRSfCPqia+cyOGpi3kzHxSfpAoYncrbGgvaPyLUvQJNGU/uBdaD9VIQPpnJknC7Q9WNqO1DJ8+1eaq53GJTFpBdNpLyjMtKAQVX+DWKtU60xSt3Du9mOM1aelxuBzoY/PT0Tf0G2zY55YkKjSFSM3bapcqAkyp3XxTrvMk7j2zwYx6xd5J+5hxQWVi7xRER+yigljA1/DVWsCz/gwWzfkw+0YmcQVf6NnyFe95Vzr6dhvAYoUkLeIvI9V9ZduSYvmrG3wr6qlW+ISLpwUjvJ/EL8atxLAHlP8PeKLh7C+W9D8lFYbEEv33KRDldLHt0AfwJjYsG197wnqC3CO7tOmxPCuC1Apj6uDdrUXLJgcsMQ2nKcdd+jYTxtNssWAOb9Wbfb80df3LB5tI1IzQAQVBUfV+CH/qIsNuqqIhknEF7vCPj7hz0QUU7QgBTxtvgYo8IEgH1Tpg4cQSJH2cw6pTStR3Uvtmv8xfFXw3bzk9iqordNoxqMN3Rh2BMmEZeHGvsBOl8p3DFpqy4e8ENZEFbcGGnOyeixmQtDaK0a5LoaTVBURnE3Q1OOnZh2oB0='
